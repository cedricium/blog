{"componentChunkName":"component---src-templates-blog-post-js","path":"/unearth-diary-03-the-tech-powering-unearth/","result":{"data":{"site":{"siteMetadata":{"title":"My Random Thoughts","author":"Cedric Amaya"}},"markdownRemark":{"id":"7a206439-6cde-558a-aeaa-2005345c8e7b","excerpt":"This is the third in a series of articles discussing my long-time side project,\nUnearth. For my more technical audience, this post will…","html":"<p>This is the third in a series of articles discussing my long-time side project,\nUnearth. For my more technical audience, this post will cover Unearth’s tech\nstack and architecture.</p>\n<hr>\n<p>Unearth subscribes to the monolithic repo (or monorepo) philosophy. Examining\nthe source code, you can see that all of the code for both the backend and\nfrontend reside in a single repository. Furthermore, the programming language of\nchoice is JavaScript since that’s what I know best.</p>\n<h2>Backend</h2>\n<ul>\n<li>Node.js</li>\n<li>Express.js</li>\n<li>PostgreSQL</li>\n<li>SocketIO</li>\n<li>Nodemailer</li>\n</ul>\n<p>The backend server is powered by Express.js, a web application framework for\nNode.js. The server itself consists of a REST API that returns JSON responses\nand an instance of a socket.io server for polling during the Reddit sync\nprocess.</p>\n<p><strong>Database</strong></p>\n<p>Data storage/persistence is accomplished using PostgreSQL. The database itself\nconsists of two tables: users and things. The former contains Unearth users and\nholds information like their Reddit id, username, email, account preferences,\nand whether they’ve completed the onboarding process. The latter contains saved\nitems (which can either be a Reddit post or comment). The things’ columns\nmirror those of Reddit data, with fields such as: <code class=\"language-text\">id</code>, <code class=\"language-text\">subreddit</code>, <code class=\"language-text\">score</code>, <code class=\"language-text\">over_18</code> (aka NSFW), and <code class=\"language-text\">url</code> to name a few. The things table also has a\n<code class=\"language-text\">user_id</code> column which is used to create a many-to-one relationship with user\nentities.</p>\n<div style=\"margin: 1rem 0 1.5rem\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/blog/static/762ca5476fe0d1aaa50d4c1da65daa59/78274/unearth-db-schema.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 107.14285714285714%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAACdklEQVQ4y5WU2W7TQBSG87C8AAhxhfoCUKmoFCEWgQQXFERLkXpB04tWrcoiUOGOqiyKm81LPF7Gy9hxfs6ZxM4CSYmlPzPxnPnmnzNnXFNZBmCAxU+By58BmFXjzuezJu69/YiNnQ9Ye32CO1tjrb46xplhYf/LOda3T3CXtL411sab97i1eYTT85aG1ph9+PUHVjcPcfvlEW4+3sPKk/pQT+u4cX9XBz/bP8XK8wNce7iHqw/eVbr+qI4razs4+PZL+6xleY4iVwiFg0GWjLZfVBooCU8mMHsCIgyh+n2kNEexqJ/1C/gyRJKmyOldjX/iOEajYUAIDxH1g1AiZEmJXq8H24vgCgHHtpEkiY5nRTTOrXBdxFE8BnJQt9uFaZoaoIOjiBTD94QGCj/Q4zZBTdOC4zg6LiTX9mihKYccIGlFOVp1CI3hlUDPR6fT0ZMZwuJF9Q5mgfyn3W7rARa7DYJguB3hVkCO8X0fKeWrXJSBbOYvYKvV0sHssFy9zI8lJFKVQSmFjGqtFM/ltnz/T+BU0mPOoVcB+xSbLxBDKyAnnJ2NDyQaJT2A5Q2B5aR5mnLICS9zMYZJvWV7BrjIZXXKDCxPuATywXDtLQ1kV4ZhwOUCndkyl40lwuUdMkyDJoAsT4jqUP4bmJJDq7wlBEn0KVObxJB8E5bOIQEbF02YtoOQbkcgI9326G6bFl21ZRwW/RxCxvhudNGwfTRFhAtXVvptCXQJOFnI88tn5HC68klznEzCBkVOX7d8ptipsBdvYdpN2eddOX5KqVCUroy+hUMpNePwslvA7jmXQB+7n1y8OPbQdmL8bEdoOQl9iHP8AXV0QD6ozH3yAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Unearth database schema\" title=\"Unearth database schema\" src=\"/blog/static/762ca5476fe0d1aaa50d4c1da65daa59/fcda8/unearth-db-schema.png\" srcset=\"/blog/static/762ca5476fe0d1aaa50d4c1da65daa59/12f09/unearth-db-schema.png 148w,\n/blog/static/762ca5476fe0d1aaa50d4c1da65daa59/e4a3f/unearth-db-schema.png 295w,\n/blog/static/762ca5476fe0d1aaa50d4c1da65daa59/fcda8/unearth-db-schema.png 590w,\n/blog/static/762ca5476fe0d1aaa50d4c1da65daa59/78274/unearth-db-schema.png 644w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n  <center>\n    <small>Unearth database schema courtesy dbdiagram.io</small>\n  </center>\n</div>\n<p><strong>Emails</strong></p>\n<p>Emails are sent using Nodemailer. Having never worked with emails or templating\nengines before, I made the mistake of going with PugJS to create the email\ntemplates. For example, take a look at the\n<a href=\"https://github.com/cedricium/unearth/blob/master/emails/welcome/html.pug\">Unearth welcome email</a>.\nPersonally, I find it very hard to read compared to traditional HTML so\nsometime in the future I would like to refactor the templates to something more\nreadable such as Handlebars.js.</p>\n<h2>Frontend</h2>\n<ul>\n<li>React.js / Gatsby</li>\n<li>Redux</li>\n<li>styled-components</li>\n</ul>\n<p>When Unearth was first built, the client app was written in React, scaffolded\nusing Create React App. I’ve since ported the entire site over to GatsbyJS.</p>\n<p><strong>Frontend Web Frameworks</strong></p>\n<p>There were a number of reasons for choosing Gatsby. One, I wanted to have a\nstatically-generated SEO-optimized landing page that was fast to load. Another\nrequirement that Gatsby allowed was not having to separate the landing site\nfrom the actual dynamic web app. I highly recommend reading\n<a href=\"https://www.gatsbyjs.org/blog/2018-11-07-gatsby-for-apps/\"><em>Gatsby for Apps</em></a>\nand watching any of Dustin Schau’s conference talks if you want to learn more\nabout using Gatsby to build hybrid static/dynamic sites.</p>\n<p><strong>Styling</strong></p>\n<p>Styled Components are used to style the landing and markdown pages. The rest of\nthe app is styled using Water.css. In the future I have plans to refactor the\nweb app, removing Water.css and replacing it with a themeable React component\nlibrary like Chakra UI.</p>\n<p><strong>State Management</strong></p>\n<p>Before Unearth was what it is today (a newsletter delivery service), it was\nsupposed to be a web app for filtering, searching, and sorting users’ Reddit\nsaves—much akin to sites like RedditManager or Savvit. As such, I setup Redux in\nthe project to help manage global state throughout the app. In addition to\nRedux, I had used helper libraries like redux-thunk and redux-persist in order\nto work with asynchronous actions and store Redux state in the user’s local\nstorage, respectively.</p>\n<p>There’s no real reason for keeping Redux on the client nowadays since there is\na minimal amount of data being fetched and worked on behind the <code class=\"language-text\">/app</code> route. I\ndon’t think I will remove it anytime soon, however, because I might venture\ndown the path of allowing users to interact with their saves—I guess we’ll see.</p>\n<h2>Deployments &#x26; DevOps</h2>\n<p>Despite using a monorepo, the backend and frontend are not coupled together\nwhen deployed. I use a Heroku hobby dyno for the backend server. This app has a\ncouple add-ons installed:</p>\n<ul>\n<li>Heroku Postgres (production hobby-basic database)</li>\n<li>Advanced Scheduler (for managing and executing cron jobs responsible for\nsending scheduled newsletters).</li>\n</ul>\n<p>The frontend is deployed via Netlify and makes use of the Netlify DNS. Some of\nthe DNS settings and records I need to manage include:</p>\n<ul>\n<li>pointing Namecheap’s nameservers to Netlify</li>\n<li>improving email deliverability using DKIM and SPF authentication</li>\n<li>domain authentication</li>\n</ul>\n<p>Both Heroku and Netlify are integrated with GitHub to do automatic deployments\nfrom the <code class=\"language-text\">master</code> branch. Netlify is specifically configured to only deploy\nwhen changes occur in the client-v2 directory.</p>\n<p>Heroku deploys everything minus the client and client-v2 directories, thus\nlimiting the size of the slug. Recently, I setup a GitHub Actions workflow to\nrun tests for all PRs and pushes to the <code class=\"language-text\">master</code> branch. Heroku uses the results\nfrom this workflow to automatically deploy new builds if all tests pass.</p>\n<p>As for emails, both transactional and scheduled/marketing emails are delivered\nvia Twilio Sendgrid. I use Zoho Mail to send one-off emails with the\n<code class=\"language-text\">tryunearth.com</code> domain to Unearth users regarding updates to the service.</p>\n<hr>\n<p>If Unearth sounds like something you would find useful,\n<a href=\"https://www.tryunearth.com/\">sign up today and give it try</a>. I would love to\nhear your thoughts about the service and any other questions or comments you may\nhave.</p>","timeToRead":4,"frontmatter":{"title":"Unearth Diary #03: The Tech Powering Unearth","date":"February 22, 2020","draft":false}}},"pageContext":{"slug":"/unearth-diary-03-the-tech-powering-unearth/","previous":{"fields":{"slug":"/unearth-diary-02-how-does-it-work/"},"frontmatter":{"title":"Unearth Diary #02: How Does It Work"}},"next":{"fields":{"slug":"/always-searching-for-answers/"},"frontmatter":{"title":"Always Searching for Answers"}}}}}